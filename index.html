<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Escâner</title>
  <link rel="stylesheet" href="layout.css" />
</head>
<body>

  <button id="scanBtn">ESCÂNER</button>
  <button id="calibrateBtn">Calibrar</button>
  <!-- novo botão Download (visível somente durante calibração) -->
  <button id="downloadBtn" style="display:none">Download</button>
  <!-- novo botão Confirmar Ponto (visível somente durante calibração) -->
  <button id="confirmPointBtn" style="display:none">Confirmar Ponto</button>

  <div id="calibration">
    <label>
      Calibração do preto:
      <span id="blackValue">30</span>
    </label>
    <input type="range" id="blackSlider" min="0" max="100" value="30">

    <label>
      Calibração do azul:
      <span id="blueValue">150</span>
    </label>
    <input type="range" id="blueSlider" min="0" max="255" value="150">

    <label>
      Calibração do verde:
      <span id="greenValue">150</span>
    </label>
    <input type="range" id="greenSlider" min="0" max="255" value="150">

    <!-- BARRA: calibração do vermelho -->
    <label>
      Calibração do vermelho:
      <span id="redValue">150</span>
    </label>
    <input type="range" id="redSlider" min="0" max="255" value="150">

    <!-- NOVO: Estabilidade dos pontos (n de amostras para média móvel) -->
    <label>
      Estabilidade dos pontos:
      <span id="stabilityValue">5</span> frames
    </label>
    <input type="range" id="stabilitySlider" min="1" max="30" value="5">

    <!-- NOVO: Margem ignorada (percentual do menor lado da câmera) -->
    <label>
      Margem ignorada:
      <span id="marginValue">5%</span>
    </label>
    <input type="range" id="marginSlider" min="0" max="20" value="5">

    <!-- NOVA: Estabilidade do ponto rosa (frames necessários para considerar o ponto estável) -->
    <label>
      Estabilidade do ponto rosa:
      <span id="pinkStabilityValue">3</span> frames
    </label>
    <input type="range" id="pinkStabilitySlider" min="1" max="30" value="3">
  </div>

  <div id="scaleInfo">
    Escala: <span id="scaleValue">--</span> px/mm
    <span id="scaleLockedLabel" style="display:none"> (travada)</span>
  </div>

  <!-- Informações de orientação -->
  <div id="orientationInfo">
    <div class="orient-row">Pitch: <span id="pitchValue">--</span>°</div>
    <div class="orient-row">Yaw: <span id="yawValue">--</span>°</div>
    <div class="orient-row">Roll: <span id="rollValue">--</span>°</div>
  </div>

  <!-- Z, X, Y e contadores -->
  <div id="zxyInfo">
    <div>+Z: <span id="zValue">--</span> mm</div>
    <div>+X (câmera): <span id="xValue">--</span> mm</div>
    <div>+Y (câmera): <span id="yValue">--</span> mm</div>

    <div>Raios definidos: <span id="raysCount">0</span></div>
    <div>Pontos rosas com direção: <span id="pinkDirectedCount">0</span></div>
    <div>Vetores rotacionados: <span id="rotatedCount">0</span></div>
    <div>Raios aceitos (triangulação): <span id="acceptedCount">0</span></div>
    <div>Raios 3D registrados: <span id="registered3DCount">0</span></div>

    <div>Pontos triangulados: <span id="triangulatedCount">0</span></div>
    <div>Estado ponto rosa: <span id="pinkState">IDLE</span></div>

    <!-- Indicador de qualidade em tempo real (visível apenas em CAPTURING) -->
    <div id="realtimeQuality" style="display:none; margin-top:6px;">
      <div style="font-size:13px; margin-bottom:4px;">Qualidade (tempo real): <span id="realtimeQualityLabel">--</span></div>
      <div class="realtime-quality-bar" aria-hidden="true">
        <div id="realtimeQualityBarFill" class="q-fill q-none" style="width:0%"></div>
      </div>
    </div>

    <!-- Nova área: distância entre par selecionado (mini-cloud) -->
    <div id="pairDistance">
      <div><strong>Par selecionado:</strong> <span id="pairInfo">nenhum</span></div>
      <div>ΔX: <span id="dxVal">--</span> mm</div>
      <div>ΔY: <span id="dyVal">--</span> mm</div>
      <div>ΔZ: <span id="dzVal">--</span> mm</div>
      <div>Distância (euclidiana): <span id="dMagVal">--</span> mm</div>
    </div>

    <!-- NOVO: Qualidade do último ponto triangulado -->
    <div id="qualityBlock" style="display:none">
      <div><strong>Qualidade do último ponto:</strong> <span id="qualityLabel">--</span></div>
      <div id="qualityMetrics">
        <div>Nº raios: <span id="qualityNumRays">--</span></div>
        <div>Erro médio (mm): <span id="qualityMeanDist">--</span></div>
        <div>Maior ângulo (°): <span id="qualityMaxAngle">--</span></div>
        <div>Espalhamento origens (mm): <span id="qualitySpread">--</span></div>
      </div>
    </div>

  </div>

  <div id="viewer">
    <video id="camera" autoplay playsinline></video>
    <canvas id="overlay"></canvas>

    <!-- mini cloud canvas (visualização rápida da nuvem triangulada) -->
    <div id="miniCloudWrap">
      <canvas id="miniCloud" width="240" height="160"></canvas>
      <!-- instrução breve -->
      <div id="miniHint">Clique em 2 pontos na nuvem</div>
    </div>
  </div>

  <script src="main.js"></script>
  <script src="export.js"></script>

</body>
</html>
